<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./src/public/css/addQuestion.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <title>Submit Question</title>
</head>

<body>
  <div class="container register">
    <div class="row">
      <div class="col-md-3 register-left">
        <img src="https://image.ibb.co/n7oTvU/logo_white.png" alt="" />
        <h3>Submission Portal</h3>
        <p>Please Enter the Question</p>  
        <!-- Form submit -->
        <form method="post" id="formMain">
        <!-- <button form="myform" type="submit" name="submit_btn" value="submitQuestion" class="btn btn-outline-light">Submit for Review</button> -->
        </form>
      </div>
      <div class="col-md-9 register-right">
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <!-- <form id="myform"  onsubmit="App.addQuestion(); return false;" class="questionForm" autocomplete="off"> -->
              <div class="form-group purple-border">
                <label class="form-group" for="cars">Select Subject:</label>
                <!-- Choose Subject -->
                <select name="subjects" id="subjects" required>
                  <option value="math">Mathematics</option>
                  <option value="phy">Physics</option>
                  <option value="chem">Chemistry</option>
                  <option value="bio">Biology</option>
                </select>
                <br><br>
                <!-- Question -->
                <label for="exampleFormControlTextarea4" class="text1 font-weight-light">Type the Question</label>
                <textarea name="questions" class="form-control addQuestionText" id="exampleFormControlTextarea4" rows="3" required></textarea>
              </div>
              <fieldset class="form-group">
                <div class="row">
                  <!-- Options available for the question -->
                  <legend class="col-form-label col-sm-4 pt-0 font-weight-light" id="text2">Enter Options</legend>
                  <div class="col-sm-10">
                    <div class="form-check">
                      <input class="form-check-input correctOption1" type="radio" name="flexRadioDefault" value="0" id="flexRadioDefault1">
                      <label class="form-check-label" for="gridRadios1">
                        <input name="option1" id="option1" type="text" required>
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input correctOption2" type="radio" name="flexRadioDefault" value="1" id="flexRadioDefault1">
                      <label class="form-check-label" for="gridRadios1">
                        <input name="option2" id="option2" type="text" required>
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input correctOption3" type="radio" name="flexRadioDefault" value="2" id="flexRadioDefault1">
                      <label class="form-check-label" for="gridRadios1">
                        <input name="option3" id="option3" type="text" required>
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input correctOption4" type="radio" name="flexRadioDefault" value="3" id="flexRadioDefault1">
                      <label class="form-check-label" for="gridRadios1">
                        <input name="option4" id="option4" type="text" required>
                      </label>
                    </div>
                    <button type="submit" onclick="App.addQuestion(); return false;" class="submit btn btn-primary">Test</button>
                  </div>
                </div>
              </fieldset>
              <footer class="blockquote-footer last-text">Please select the correct option before submitting</cite>
              </footer>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.3/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@truffle/contract@4.3.5/dist/truffle-contract.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>
    
    <script src="../Web3.js"></script>
    
    <!-- <script>
      App = {
        web3Provider: null,
        contracts: {},
        account: "0x0",
      
        init: function () {
          return App.initWeb3();
        },
      
        initWeb3: function () {
          if (typeof web3 !== "undefined") {
            App.web3Provider = web3.currentProvider;
            web3 = new Web3(web3.currentProvider);
          } else {
            App.web3Provider = new Web3.providers.HttpProvider(
              "http://localhost:7545"
            );
            web3 = new Web3(App.web3Provider);
          }
          web3.eth.getCoinbase(function (err, account) {
            if (err === null) {
              App.account = account;
            }
          });
      
          return App.initContract();
        },
        initContract: function () {
          $.getJSON("CrowdSource.json", function (cq) {
            App.contracts.CrowdSource = TruffleContract(cq);
            App.contracts.CrowdSource.setProvider(App.web3Provider);
      
            // App.listenForEvents();
      
            // return App.render();
          });
        },
      
        listenForEvents: function () {
          App.contracts.CrowdSource.deployed().then(function (instance) {
            instance
              .SubmitQuestion(
                {},
                {
                  fromBlock: 0,
                  toBlock: "latest",
                }
              )
              .watch(function (error, event) {
                console.log("event triggered", event);
                App.render();
              });
          });
        },
      
        addQuestion: function () {
          console.log("here");
          let submitDOM = document.querySelector(".submit");
          // console.log(submitDOM);
          const Problem = {
            subject: "",
            question: "",
            options: [],
            ans: 0,
          };
      
          // console.log(Problem);
          submitDOM.addEventListener("click", function (event) {
            event.preventDefault();
            subject();
            question();
            correctOption();
            options();
            console.log(Problem);
            App.contracts.CrowdSource.deployed()
            .then(function (instance) {
              console.log("test");
              const result = instance.addToBlockchain(
                Problem.subject,
                Problem.question,
                Problem.options,
                "IPFS Image hash",
                Problem.ans,
                false,
                { from: App.account }
              );
              console.log(result);
              return result;
            })
            .then(function (result) {
              window.alert("Question added successfully");
              // Wait for votes to update
              // $("#content").hide();
              // $("#loader").show();
            })
            .catch(function (err) {
              console.error(err);
            });
          });
      
          // //For subject
          const subject = () => {
            let subjectsDOM = document.querySelector("#subjects");
            let selectedSubject = subjectsDOM.options[subjectsDOM.selectedIndex].text;
            Problem.subject = selectedSubject;
          };
      
          //For question
          const question = () => {
            let questionDOM = document.querySelector(".addQuestionText");
            let questionText = questionDOM.value;
            Problem.question = questionText;
          };
      
          //For Correct Option
          const correctOption = () => {
            let correctOption1 = document.querySelector(".correctOption1");
            let correctOption2 = document.querySelector(".correctOption2");
            let correctOption3 = document.querySelector(".correctOption3");
            let correctOption4 = document.querySelector(".correctOption4");
            if (correctOption1.checked == true) {
              Problem.ans = 0;
              return;
            } else if (correctOption2.checked == true) {
              Problem.ans = 1;
              return;
            } else if (correctOption3.checked == true) {
              Problem.ans = 2;
              return;
            } else if (correctOption4.checked == true) {
              Problem.ans = 3;
              return;
            }
          };
      
          //For Options
          const options = () => {
            let option1 = document.querySelector("#option1");
            let option2 = document.querySelector("#option2");
            let option3 = document.querySelector("#option3");
            let option4 = document.querySelector("#option4");
            Problem.options.push(option1.value);
            Problem.options.push(option2.value);
            Problem.options.push(option3.value);
            Problem.options.push(option4.value);
          };
      
      
          // console.log(result);
          // window.alert("Question added successfully");
        },
      };
      
      $(function () {
        $(window).load(function () {
          App.addQuestion();
          App.init();
        });
      });
    </script> -->
</body>

</html>